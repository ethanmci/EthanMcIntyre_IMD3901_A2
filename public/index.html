<!DOCTYPE html>
<html>
    <head>
      <title>DS3 - Assignment 2</title>
      <meta name="description" content="DS3 - Assignment 2">
      <script src="js/aframe.min.js"></script>
      <script src="js/circles-sphere-env-map.js"></script>
      <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
      <link rel="stylesheet" href="css/main.css">
      <script>
        AFRAME.registerComponent('start-experience', {
          init: function () {
            console.log('scene loaded');
            document.querySelector('#menu-overlay').style.display='block';
          }
        });

        function startExperience() {
          document.querySelector('#menu-overlay').style.display = 'none';
          
          const ambientSounds = document.querySelectorAll('.ambient-sounds');
          ambientSounds.forEach(e => {
            e.components.sound.playSound();
          });
        }
      </script>
    </head>
    <body>
      <div id="menu-overlay">
          <button id="menu-start-button" onclick="startExperience()">Start Experience</button>
      </div>


      <a-scene renderer="colorManagement: true; physicallyCorrectLights:true;">
        <a-assets>
          <a-asset-item id="flashlight_model" response-type="arraybuffer" src="assets/models/flashlight/scene.gltf"></a-asset-item>
          <a-asset-item id="skeleton_model" response-type="arraybuffer" src="assets/models/skeleton/scene.gltf"></a-asset-item>
          <audio id="ambience" src="assets/sounds/ambience.mp3" preload="auto" crossorigin="anonymous"></audio>
        </a-assets>
        <a-entity></a-entity>


        <a-entity camera look-controls wasd-controls position="0 1.6 0" light="type: point; color: #FFF; intensity: 0.05;">
          <a-entity id="flashlight_inhand" gltf-model="#flashlight_model" position="0 -0.7 -1" rotation="-80 0 0" scale="0.001 0.001 0.001"></a-entity>
          <a-entity light="type: spot; angle: 45; penumbra: 0.2; decay: 1.8;"></a-entity>
          <a-entity class="ambient-sounds" sound="src: #ambience; loop: true;"></a-entity>
        </a-entity>

        <a-entity geometry="primitive: box;" material="color: gray" position="0 0 -4" scale="0.5 2 0.5">
          <a-entity id="flashlight_prompt" text="font: mozillavr; value: Click to pick up the flashlight; width: 5; align: center;" position="0 0.9 0" scale="1 0.5 1"></a-entity>
        </a-entity>
        
        <a-entity geometry="primitive: box;" material="color: gray" position="0 0 2" scale="0.5 2 0.5">
          <a-entity geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)" position="0 2.1 0"></a-entity>
        </a-entity>

        <a-entity light="type: spot; angle: 10; penumbra: 0.7; decay: 1;" position="0 7 -4" rotation="-90"></a-entity>

        <a-entity id="flashlight_item" gltf-model="#flashlight_model" position="0 1.3 -4" rotation="0 0 45" scale="0.0004 0.0004 0.0004" light="type: point; color: #FFF; intensity: 0.15;" animation="property: rotation; to: 0 360 45; dur: 5000; easing: linear; loop: true"></a-entity>

        <!-- room geometry -->
        <a-entity>
          <a-entity geometry="primitive: plane; height: 15; width: 20;" rotation="0 90 0" material="color: #883016" position="-10 0 0"></a-entity>
          <a-entity geometry="primitive: plane; height: 15; width: 20;" rotation="0 -90 0" material="color: #883016" position="10 0 0"></a-entity>
          <a-entity geometry="primitive: plane; height: 20; width: 15;" rotation="0 0 -90" material="color: #883016" position="0 0 -10"></a-entity>
          <a-entity geometry="primitive: plane; height: 20; width: 15;" material="side:back; color: #883016" rotation="0 0 90" position="0 0 10"></a-entity>
          <a-entity geometry="primitive: plane; height: 20; width: 20;" material="color: #883016" rotation="90 0 0" position="0 7.5 0"></a-entity>
          <a-entity geometry="primitive: plane; height: 20; width: 20;" material="side:back;" rotation="90 0 0" position="0 0 0"></a-entity>
        </a-entity>
      </a-scene>
    </body>
</html>